# ============================================================
# ===  Application Configuration for Survey Management  =====
# ============================================================

# ------------------------
# Server settings
# ------------------------
server.port=8080
spring.application.name=server

# ------------------------
# Database configuration
# ------------------------
spring.datasource.url=jdbc:postgresql://localhost:5432/survey
spring.datasource.username=postgres
spring.datasource.password=rabbit
spring.datasource.driver-class-name=org.postgresql.Driver
spring.jpa.database-platform=org.hibernate.dialect.PostgreSQLDialect

# --- Hikari (pool) ---
spring.datasource.hikari.maximum-pool-size=10
spring.datasource.hikari.minimum-idle=2
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.validation-timeout=5000
spring.datasource.hikari.initializationFailTimeout=0
spring.datasource.hikari.pool-name=HikariPool-1
spring.datasource.hikari.connection-test-query=SELECT 1

# JPA & Hibernate
spring.jpa.hibernate.ddl-auto=validate
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect

# Enable Hibernate filter auto-registration
spring.jpa.properties.hibernate.enable_lazy_load_no_trans=true

# Flyway migration
spring.flyway.enabled=true
spring.flyway.locations=classpath:db/migration
spring.flyway.baseline-on-migrate=true
spring.flyway.baseline-version=0
# (Dev only) uncomment if needed:
# spring.flyway.clean-disabled=false
# spring.flyway.clean-on-validation-error=true

spring.flyway.default-schema=public
spring.jpa.properties.hibernate.default_schema=public
# ------------------------
# JWT / Security settings
# ------------------------
app.jwt.secret=change-me-in-dev
app.jwt.issuer=survey-app
app.jwt.expiration-minutes=60

# Legacy aliases (in case any class still reads the old names)
app.security.jwt.secret=${app.jwt.secret}
app.security.jwt.issuer=${app.jwt.issuer}

# Disable basic auth & sessions
spring.security.filter.dispatcher-types=REQUEST
spring.main.web-application-type=servlet

# ------------------------
# Swagger (springdoc-openapi)
# ------------------------
springdoc.api-docs.path=/v3/api-docs
springdoc.swagger-ui.path=/swagger-ui/index.html
springdoc.packages-to-scan=package com.rakuten.mobile.web
springdoc.show-actuator=true

# ------------------------
# Logging
# ------------------------
logging.level.root=INFO
logging.level.org.springframework.web=INFO
logging.level.org.hibernate.SQL=DEBUG
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=TRACE

# ------------------------
# Async Executor
# ------------------------
spring.task.execution.pool.core-size=2
spring.task.execution.pool.max-size=8
spring.task.execution.pool.queue-capacity=100
spring.task.execution.thread-name-prefix=async-
spring.task.execution.shutdown.await-termination=true
spring.task.execution.shutdown.await-termination-period=10s

# ------------------------
# Json type
# ------------------------
spring.jackson.mapper.accept-case-insensitive-enums=true
spring.jackson.serialization.WRITE_NULL_MAP_VALUES=true
spring.jackson.serialization.WRITE_DATES_AS_TIMESTAMPS=false
spring.jackson.serialization.FAIL_ON_EMPTY_BEANS=false
# ------------------------
# Misc
# ------------------------
spring.output.ansi.enabled=ALWAYS
